{% extends "puzzles/base_generic.html" %}

{% block content %}
<div class="puzzle-blurb">
  <span class="status-{{ puzzle.status.css_name }}">
    <a class="puzzle-title" target="_blank" href="{{ puzzle.url }}">{{ puzzle.title }}</a>
    Status:
    <form id="status_form" action="{% url puzzles.views.puzzle_set_status puzzle.id %}" method="post">{% csrf_token %}
      <input type="hidden" name="continue" value="{{ path }}" />
      <select onchange="document.forms.status_form.submit()" name="status">
	{% for status in statuses %}
	<option{% if puzzle.status == status %} selected="true"{% endif %}>{{ status.text }}</option>
	{% endfor %}
      </select>
    </form>
    Priority:
    <form id="priority_form" action="{% url puzzles.views.puzzle_set_priority puzzle.id %}" method="post">{% csrf_token %}
      <input type="hidden" name="continue" value="{{ path }}" />
      <select onchange="document.forms.priority_form.submit()" name="priority">
	{% for priority in priorities %}
	<option{% if puzzle.priority == priority %} selected="true"{% endif %}>{{ priority.text }}</option>
	{% endfor %}
      </select>
    </form>
  </span>

  <table id="whos-working">
    <thead>
      <tr><th colspan=2>Working now:</th></tr>
    </thead>
    <tbody>
      {% if not you_solving and not other_solvers %}
      <tr>
	<td>nobody</td>
      </tr>
      {% endif %}
      {% if you_solving %}
      <tr>
	<td><b>You</b></td>
	<td>
	  <form action="{% url puzzles.views.puzzle_remove_solver puzzle.id %}" method="post">{% csrf_token %}
	    <input type="hidden" name="continue" value="{{ path }}" />
	    <input type="hidden" name="solver" value="{{ user.id }}" />
	    <input type="image" src="{{ STATIC_URL }}img/remove.png" type="submit" alt="Remove" />
	  </form>
	</td>
      </tr>
      {% endif %}
      {% for solver in other_solvers %}
      <tr>
	<td title="{{ solver.first_name }} {{ solver.last_name }} ({{ solver.userprofile.location }})">{{ solver.first_name }}</td>
	<td>
	  <form action="{% url puzzles.views.puzzle_remove_solver puzzle.id %}" method="post">{% csrf_token %}
	    <input type="hidden" name="continue" value="{{ path }}" />
	    <input type="hidden" name="solver" value="{{ solver.id }}" />
	    <input type="image" src="{{ STATIC_URL }}img/remove.png" alt="Remove" />
	  </form>
	</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <span>
    Add:
    {% if not you_solving %}
    <form action="{% url puzzles.views.puzzle_add_solver puzzle.id %}" method="post">{% csrf_token %}
      <input type="hidden" name="continue" value="{{ path }}" />
      <input type="hidden" name="solver" value="{{ user.id }}" />
      <input type="submit" value="Me" />
    </form>
    {% endif %}
    <form id="add_other_user" action="{% url puzzles.views.puzzle_add_solver puzzle.id %}" method="post">{% csrf_token %}
      <input type="hidden" name="continue" value="{{ path }}" />
      <select onchange="document.forms.add_other_user.submit()" name="solver">
	<option>Other user...</option>
	{% for other_user in other_users %}
	<option value="{{ other_user.id }}">{{ other_user.first_name }} {{ other_user.last_name }}</option>
	{% endfor %}
      </select>
    </form>
  </span>

  {% if puzzle.answer %}
  Answer: <span class="puzzle-answer">{{ puzzle.answer }}</span>
  {% else %}
  {% if puzzle.checkAnswerLink %}
  <a target="_blank" href="{{ puzzle.checkAnswerLink }}">Call in answer</a>
  {% endif %}
  {% endif %}
  {% if wrong_answers %}
  Wrong answers:
  <ul id="puzzle-wrong-answers">
    {% for wrong_answer in wrong_answers %}
    <li>{{ wrong_answer.answer }}</li>
    {% endfor %}
  </ul>
  {% endif %}

  <a target="_blank" href="{% url puzzles.views.puzzle_logged_chat puzzle.id %}">Logged chat</a>

  <a href="{% url puzzles.views.puzzle_upload puzzle.id %}">Upload file</a>

  {% if uploaded_files %}
  Uploaded files:
  <ul id="puzzle-uploads">
  {% for upload in uploaded_files %}
  <li><a target="_blank" href="{{ upload.url }}">{{ upload.name }}</a></li>
  {% endfor %}
  </ul>
  {% endif %}
</div>
{% endblock %}
